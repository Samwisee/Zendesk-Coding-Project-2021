<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title>Samdesk</title>
  </head>
  <body>
    <h1>Samdesk Ticketing</h1>
      <table>
        <tbody id="table-body">
        </tbody>
      </table>
      
      <div id="pagination"></div>
      <script async="async" type="text/javascript" src="main.js"></script>
    <script>

      const ticketsArray = [
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  },
  {
    url: "https://samcheney.zendesk.com/api/v2/tickets/1.json",
    id: 1,
    external_id: null,
    via: { channel: "sample_ticket", source: { from: [Object], to: [Object], rel: null } },
    created_at: "2021-05-03T23:11:21Z",
    updated_at: "2021-05-03T23:11:22Z",
    type: "incident",
    subject: "Sample ticket: Meet the ticket",
    raw_subject: "Sample ticket: Meet the ticket",
    description: "Hi Sam,\n\nThis is your first ticket. Ta-da! Any customer request sent to your supported channels (ema...",
    priority: "normal",
    status: "open",
    recipient: null,
    requester_id: 902094189446,
    submitter_id: 902095768443,
    assignee_id: 902095768443,
    organization_id: null,
    group_id: 900004607946,
    collaborator_ids: [],
    follower_ids: [],
    email_cc_ids: [],
    forum_topic_id: null,
    problem_id: null,
    has_incidents: false,
    is_public: true,
    due_at: null,
    tags: [ "sample", "support", "zendesk" ],
    custom_fields: [],
    satisfaction_rating: null,
    sharing_agreement_ids: [],
    fields: [],
    followup_ids: [],
    ticket_form_id: 900000356846,
    brand_id: 900001274646,
    allow_channelback: false,
    allow_attachments: true
  }
]

      // TODO change back to 25
      const paginationState = {
        ticketArray: ticketsArray,
        page: 1,
        rows: 5,
      }

      function setPagination (ticketArray, page, rows) {
        // Set page start and end messages
        let startPoint = (page - 1) * rows
        let endPoint = startPoint + rows

        // Divide messages into pages
        let ticketPage = ticketArray.slice(startPoint, endPoint)
        let pages = Math.ceil(ticketArray.length / rows)

        return {
          ticketArray: ticketPage,
          pages: pages
        }
      }
      
      // Build pagination buttons
      function buildPageButtons(pages) {
        const wrapper = document.getElementById('pagination')
        wrapper.innerHTML = ''

        for (let index = 1; index <= pages; index ++) {
          wrapper.innerHTML += `<button
                                  value=${index} 
                                  onClick="handlePageClick(this.value)" 
                                  class="pageButton">
                                  ${index}
                                </button>`
        }

      }
      
      function handlePageClick (val) {
        document.getElementById('table-body').innerHTML = ''
        paginationState.page = val
        buildTable()
      }

      // Sets up table on page load and kicks everything
      function buildTable () {
        const table = document.getElementById('table-body')

        let paginationData = setPagination(paginationState.ticketArray, paginationState.page, paginationState.rows)

        let ticketIndex = 0

        // Build ticket buttons
        for(ticketIndex of paginationData.ticketArray) {
          let row = document.createElement('tr')
          row.innerHTML = `<button
                            value=${ticketIndex} 
                            onClick="handleLinkClick(this.value)" 
                            class="pageButton"
                            href="">
                              ${ticketIndex.subject}
                              ${ticketIndex.priority}
                          </button>`
          
          table.append(row)
        }
        buildPageButtons(paginationData.pages)
      }
      
      function handleLinkClick (ticketDetails) {
        window.location = ticketDetails.url
        console.log(ticketDetails)
      }
      
      buildTable()

    </script>
  </body>
</html>